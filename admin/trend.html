<!--
Created: 2020-03-27 19:40:22
Last Modified:2020-03-31 11:09:57
Filename:trend.html
Project:admin
Author : YukiMuraRindon
Email : rinndonn@outlook.com
--------------------------------------------------------
Description: 
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="YukiMuraRindon" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge,chrome=1" />
    <link rel="Website icon" href="img/favicon.ico" type="image/x-icon" />
    <title>后台管理界面</title>
  </head>
  <!--引入组件，缺少axios-->
  <script src="lib/vue.js"></script>
  <script src="lib/element.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css" />
  <link href="./css/style.css" type="text/css" rel="stylesheet" />
  <script src="lib/axios.js"></script>

  <!--echarts组件-->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-gl/dist/echarts-gl.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-stat/dist/ecStat.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/extension/dataTool.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/map/js/china.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/map/js/world.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/extension/bmap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/echarts@4.1.0/dist/echarts.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue-echarts@4.0.2"></script>
  <body style="height:550px;">
    <!--顶部菜单-->
    <div class="head">
      <a href="./index.html"><img src="img/logo.jpg" id="img"/></a>
      <div id="toplist">
        <el-menu :default-active="activeIndex" class="el-menu" mode="horizontal" @select="handleSelect">
          <el-menu-item index="1"><a href="./index.html">商品管理</a></el-menu-item>
          <el-menu-item index="2"><a href="./order.html">订单管理</a></el-menu-item>
          <el-menu-item index="3"><a href="./user.html">用户管理</a></el-menu-item>
          <el-menu-item index="4"><a href="./trend.html">订单趋势</a></el-menu-item>
          <el-menu-item index="5"><a href="#">数据统计</a></el-menu-item>
        </el-menu>
      </div>
      <div id="user" v-on:click="link">
        <el-avatar class="block"><el-avatar :size="41" :src="circleUrl"></el-avatar></el-avatar>
      </div>
    </div>
    <!--图表开始-->
    <div id="chart">
      <!--表1饼图-->
      <div id="chart1" style="height: 265px;width:300px;float:left;">
        <div id="orderChart1" style="height: 100%;margin-top: 0px;"></div>
      </div>
      <!--表2柱图-->
      <div id="chart2" style="height: 265px;width:300px;float:left;">
        <div id="orderChart2" style="height: 100%;margin-top: 0px;"></div>
      </div>
    </div>
    <!--底部菜单-->
    <hr id="line" />
    <div id="footer">
      <p>酒店订餐系统 HOTEL RESERVATION SYSTEM © 2020</p>
      <p>Powered and Maintained by Rindon . All Rights Reserved.</p>
    </div>
  </body>

  <script>
    var toplist = {
      data() {
        return {
          activeIndex: "4",
          activeIndex2: "1"
        };
      },
      methods: {
        handleSelect(key, keyPath) {
          console.log(key, keyPath);
        }
      }
    };

    var orderChart = {
      beforeCreate() {
        axios({
          method: "get",
          url: "http://192.168.2.201/statistics/orderstat/"
        }) //执行get请求
          .then(function(response) {
            localStorage.lu = response.data.lu;
            localStorage.chuan = response.data.chuan;
            localStorage.yue = response.data.yue;
          }) //处理数据（赋给info
          .catch(error => {
            console.log(error); //这里应该有错误处理
          }); //错误处理
      },
      data() {
        return {
          orderData: {
            lu: 0,
            yue: 0,
            chuan: 0
          },
          option1: null,
          option2: null
        };
      },
      methods: {
        drawChart1() {
          let orderChart = echarts.init(document.getElementById("orderChart1"));
          this.getChert1();
          this.option1 = {
            title: {
              text: "用户下单趋势",
              subtext: "根据用户下单数据统计",
              left: "center"
            },
            tooltip: {
              trigger: "item",
              formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
              orient: "vertical",
              left: "left",
              data: ["粤菜", "鲁菜", "川菜"]
            },
            series: [
              {
                name: "用户下单量",
                type: "pie",
                radius: "55%",
                center: ["50%", "60%"],
                data: [
                  { value: localStorage.yue, name: "粤菜" },
                  { value: localStorage.lu, name: "鲁菜" },
                  { value: localStorage.chuan, name: "川菜" }
                ],
                emphasis: {
                  itemStyle: {
                    shadowBlur: 10,
                    shadowOffsetX: 0,
                    shadowColor: "rgba(0, 0, 0, 0.5)"
                  }
                }
              }
            ]
          };
          orderChart.setOption(this.option1, true);
        },
        getChert1: function() {
          axios({
            method: "get",
            url: "http://192.168.2.201/statistics/orderstat/"
          }) //执行get请求
            .then(function(response) {
              localStorage.lu = response.data.lu;
              localStorage.chuan = response.data.chuan;
              localStorage.yue = response.data.yue;
            }) //处理数据（赋给info
            .catch(error => {
              console.log(error); //这里应该有错误处理
            }); //错误处理
          //console.log(localStorage.lu);
        },
        //获取chert2的数据
        getChert2: function() {
          axios({
            method: "get",
            url: "http://192.168.2.201/statistics/userord/"
          }) //执行get请求
            .then(function(response) {
              localStorage.user1 = response.data[0].price;
              localStorage.user2 = response.data[1].price;
              localStorage.user3 = response.data[2].price;
            }) //处理数据（赋给info
            .catch(error => {
              console.log(error); //这里应该有错误处理
            }); //错误处理
        },
        drawChart2: function() {
          let orderChart = echarts.init(document.getElementById("orderChart2"));
          this.getChert2();
          this.option2 = {
            tooltip: {
              trigger: "axis",
              axisPointer: {
                // 坐标轴指示器，坐标轴触发有效
                type: "shadow" // 默认为直线，可选为：'line' | 'shadow'
              }
            },
            grid: {
              left: "3%",
              right: "4%",
              bottom: "3%",
              containLabel: true
            },
            xAxis: {
              type: "category",
              data: ["土豪1", "土豪2", "土豪3"]
            },
            yAxis: {
              type: "value",
              max: 3000,
              min: 0,
              interval: 500
            },
            series: [
              {
                name: "下单前三名",
                barWidth: "60%",
                data: [parseInt(localStorage.user1), parseInt(localStorage.user2), parseInt(localStorage.user3)],
                type: "bar"
              }
            ]
          };
          orderChart.setOption(this.option2, true);
        }
      },
      mounted() {
        this.drawChart1();
        this.drawChart2();
      }
    };

    var Ctor = Vue.extend(toplist);
    new Ctor().$mount("#toplist");
    var Ctor = Vue.extend(orderChart);
    new Ctor().$mount("#chart");
  </script>
</html>
